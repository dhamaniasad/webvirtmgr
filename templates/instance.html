{% extends "base.html" %}
{% load i18n %}
{% load staticfiles %}
{% block title %}{% trans "VM's" %} - {{ vname }}{% endblock %}
{% block content %}
    {% include 'sidebar.html' %}
    <div class="main">
        {% if errors %}
            {% for error in errors %}
                <div class="alert alert-danger">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                    {{ error }}
                </div>
            {% endfor %}
        {% endif %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

            <table class="table">
                <thead>
                <tr class="active">
                    <th>{% trans "Name" %}</th>
                    <th>{% trans "Status" %}</th>
                    <th>{% trans "VPU's" %}</th>
                    <th>{% trans "Memory" %}</th>
                </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>{{ vname }}</td>
                        <td>{% if status %}
                            <span class={% ifequal status 5 %}"text-danger">{% trans "Shuttoff" %}{% endifequal %}
                                        {% ifequal status 1 %}"text-success">{% trans "Running" %}{% endifequal %}
                                        {% ifequal status 3 %}"text-warnging">{% trans "Suspend" %}{% endifequal %}
                            </span>
                            {% else %}
                                {% trans "None" %}
                            {% endif %}
                        </td>
                        <td>{% if cur_vcpu %}{{ cur_vcpu }}{% else %}{{ vcpu }}{% endif %}</td>
                        <td>{{ cur_memory }}{% trans "MB" %}</td>
                    <tr>
                </tbody>
            </table>
        <hr>
        <ul class="nav nav-tabs" style="height: 61px;">
            <li class="active">
                <a class="inst-btn" href="#power" data-toggle="tab">
                    <span class="glyphicon glyphicon-off"></span><br>{% trans "Power" %}
                </a>
            </li>
            <li><a class="inst-btn" href="#access" data-toggle="tab">
                    <span class="glyphicon glyphicon-briefcase"></span><br>{% trans "Access" %}
                </a>
            </li>
            <li><a class="inst-btn" href="#snapshots" data-toggle="tab">
                    <span class="glyphicon glyphicon-camera"></span><br>{% trans "Snapshots" %}
                </a>
            </li>
            <li><a class="inst-btn" href="#graph" data-toggle="tab">
                    <span class="glyphicon glyphicon-signal"></span><br>{% trans "Graphics" %}
                </a>
            </li>
            <li><a class="inst-btn" href="#settings" data-toggle="tab">
                    <span class="glyphicon glyphicon-wrench"></span><br>{% trans "Settings" %}
                </a>
            </li>
            <li><a class="inst-btn" href="#migrate" data-toggle="tab">
                    <span class="glyphicon glyphicon-cloud-download"></span><br>{% trans "Migrate" %}
                </a>
            </li>
            <li><a class="inst-btn" href="#delete" data-toggle="tab">
                    <span class="glyphicon glyphicon-trash"></span><br>{% trans "Destroy" %}
                </a>
            </li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane active" id="power" style="margin-top: 20px">
                <ul class="nav nav-tabs ">
                    <li class="active"><a href="#shutdown" data-toggle="tab">{% trans "Shutdown" %}</a></li>
                    <li><a href="#forceshutdown" data-toggle="tab">{% trans "Force Shutdown" %}</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane tab-inst active" id="shutdown">
                        <p>{% trans "This will power off your droplet. recommend powering off your droplet through the command line, as this action is the same as hard resetting the server and may cause data corruption. Do you wish to proceed?" %}</p>
                        <form action="" method="post">{% csrf_token %}
                            {% ifequal status 5 %}
                                <button type="submit" name="start" class="btn btn-lg btn-primary pull-right">{% trans "Start" %}</button>
                            {% else %}
                                <button type="submit" name="power" value="shutdown" class="btn btn-lg btn-primary pull-right">{% trans "Shutdown" %}</button>
                            {% endifequal %}
                        </form>
                        <div class="clearfix"></div>
                    </div>
                    <div class="tab-pane tab-inst" id="forceshutdown">
                        <p>{% trans "This will power off your droplet. recommend powering off your droplet through the command line, as this action is the same as hard resetting the server and may cause data corruption. Do you wish to proceed?" %}</p>
                        <form action="" method="post">{% csrf_token %}
                            {% ifequal status 5 %}
                                <button type="submit" name="start" class="btn btn-lg btn-primary pull-right">{% trans "Start" %}</button>
                            {% else %}
                                <button type="submit" name="power" value="destroy" class="btn btn-lg btn-primary pull-right">{% trans "Force Shutdown" %}</button>
                            {% endifequal %}
                        </form>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="access" style="margin-top: 20px">
                <ul class="nav nav-tabs ">
                    <li class="active"><a href="#console" data-toggle="tab">{% trans "Console" %}</a></li>
                    <li><a href="#vnc" data-toggle="tab">{% trans "VNC Settings" %}</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane tab-inst active" id="console">
                        <p>{% trans "This will open up a console VNC connection to your droplet and is the equivalent of plugging a monitor and keyboard directly to your virtual server." %}</p>
                        {% ifequal status 5 %}
                            <button class="btn btn-primary btn-lg pull-right disabled">{% trans "Console" %}</button>
                        {% else %}
                            <a href="#" class="btn btn-primary btn-lg pull-right" title="VNC Port: {{ vnc_port }}" onclick="open_vnc()">{% trans "Console" %}</a>
                        {% endifequal %}
                        <div class="clearfix"></div>
                    </div>
                    <div class="tab-pane tab-inst" id="vnc">
                        <p>{% trans "You cant set passord" %}</p>
                        <div class="col-lg-3">
                            <form class="form-horizontal" method="post" role="form">{% csrf_token %}
                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <div class="checkbox">
                                          <label>
                                            <input type="checkbox" name="auto_pass" value="true" id="vnc_passwd_gen">{% trans "Generate" %}
                                          </label>
                                        </div>
                                     </div>
                                </div>
                                <div class="form-group" id="vnc_passwd_manual">
                                    <label for="inputPassword1" class="col-sm-2 control-label">{% trans "Password" %}</label>
                                    <div class="col-sm-6">
                                        <input type="password" class="form-control" name="vnc_passwd" placeholder="{% trans "Password" %}" maxlength="14">
                                    </div>
                                </div>
                                {% if computes_count != 1 %}
                                    <button class="btn btn-primary btn-lg pull-right disabled" name="set_vnc_passwd">{% trans "Set Password" %}</button>
                                {% else %}
                                    <button type="submit" class="btn btn-primary btn-lg pull-right" name="set_vnc_passwd">{% trans "Set Password" %}</button>
                                {% endif %}
                            </form>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="settings" style="margin-top: 20px">
               <div class="col-md-6">
                    <p><strong>{% trans "Description" %}:</strong></p>
                    <p><strong>{% trans "Autostart" %}:</strong></p>
                </div>
                <div class="col-md-6">
                    <p>{{ description }}</p>
                    <p>
                        <form action="" method="post">{% csrf_token %}
                            {% ifequal autostart 0 %}
                                <input type="submit" class="btn btn-xs btn-default" name="set_autostart" value="{% trans "Enable" %}">
                            {% else %}
                                <input type="submit" class="btn btn-xs btn-default" name="unset_autostart" onclick="return confirm('{% trans "Are you sure?" %}')" value="{% trans "Disable" %}">
                            {% endifequal %}
                        </form>
                    </p>
                </div>
                <div class="col-md-6">
                     {% for network in networks %}
                        <p><strong>Eth{{ forloop.counter0 }}</strong></p>
                     {% endfor %}
                </div>
                <div class="col-md-6">
                    {% for network in networks %}
                        {% if network.ip %}
                            <p>{{ network.ip }} ({{ network.nic }})</p>
                        {% else %}
                            <p>{{ network.mac }} ({{ network.nic }})</p>
                        {% endif %}
                    {% endfor %}
                </div>
                <hr>
                <div class="col-md-6">
                    {% for disk in disks %}
                        <p><strong>{% trans "Disk" %} {{ disk.dev }}</strong></p>
                    {% endfor %}
                </div>
                <div class="col-md-6">
                    {% for disk in disks %}
                        <p>{{ disk.image }} ({{ disk.storage }})</p>
                    {% endfor %}
                </div>
                <hr>
                {% if media %}
                    <div class="col-md-6">
                        <p><strong>{% trans "Connected" %}</strong></p>
                    </div>
                    <div class="col-md-6">
                        {% for iso in media %}
                        <p>{{ iso.image }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
                <form action="" method="post">{% csrf_token %}
                    {% if media %}
                        <input type="hidden" name="iso_media" value="{{ media.0.path }}">
                        <button type="submit" class="btn btn-default"  name="umount_iso" onclick="return confirm('{% trans "Are you sure?" %}')">{% trans "Disconnect" %}</button>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label">{% trans "Images" %}</label>
                            <div class="col-sm-6">
                                <select name="iso_media" class="form-control">
                                    {% if media_iso %}
                                        {% for iso in media_iso %}
                                            <option value="{{ iso }}">{{ iso }}</option>
                                        {% endfor %}
                                    {% else %}
                                        <option value="none">{% trans "None" %}</option>
                                    {% endif %}
                                </select>
                            <br>
                            {% if media_iso %}
                                <button type="submit" class="btn btn-default" name="mount_iso" >{% trans "Connect" %}</button>
                            {% else %}
                                <button class="btn btn-default disabled" name="connect">{% trans "Connect" %}</button>
                            {% endif %}
                            </div>
                        </div>
                    {% endif %}
                </form>
            </div>
            <div class="tab-pane" id="snapshots">
                <ul class="nav nav-tabs" style="margin-top: 20px">
                    <li class="active"><a href="#createsnapshot" data-toggle="tab">{% trans "Create Snapshot" %}</a></li>
                    <li><a href="#istaceshapshosts" data-toggle="tab">{% trans "Restore from Snapshots" %}</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane tab-inst active" id="createsnapshot">
                        <p>{% trans "This will power off your droplet. recommend powering off your droplet through the command line, as this action is the same as hard resetting the server and may cause data corruption. Do you wish to proceed?" %}</p>
                        <form class="form-horizontal" method="post" role="form">{% csrf_token %}
                            <div class="form-group">
                                <label for="snapshot" class="col-sm-2 control-label">{% trans "Name" %}</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" name="name" placeholder="{% trans "Name" %}" maxlength="14">
                                </div>
                            </div>
                            {% ifequal status 5 %}
                                <button type="submit" class="btn btn-primary btn-lg pull-right" name="snapshot">{% trans "Create Snapshot" %}</button>
                            {% else %}
                                <button class="btn btn-primary btn-lg pull-right disabled">{% trans "Create Snapshot" %}</button>
                            {% endifequal %}
                        </form>
                        <div class="clearfix"></div>
                    </div>
                    <div class="tab-pane tab-inst" id="istaceshapshosts">
                        {% if vm_snapshot %}
                            <table class="table table-bordered">
                                <thead>
                                <tr>
                                    <th>{% trans "Name" %}</th>
                                    <th>{% trans "Date" %}</th>
                                    <th colspan="2">{% trans "Action" %}</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for name, time in vm_snapshot.items %}
                                    <tr>
                                        <td><strong>{{ name }}</strong></td>
                                        <td>{{ time.0|date:"M d H:i:s" }}</td>
                                        <td style="width:30px;">
                                            <form action="" method="post" style="height:10px;">{% csrf_token %}
                                                <input type="hidden" name="name" value="{{ name }}">
                                                {% ifnotequal time.1 3 %}
                                                    <button type="submit" class="btn btn-sm btn-primary" name="revert" value="revert" onclick="return confirm('Are you sure?')">{% trans "Revert" %}</button>
                                                {% else %}
                                                    <button type="button" class="btn btn-sm btn-primary disabled" name="revert" value="Revert">{% trans "Revert" %}</button>
                                                {% endifnotequal %}
                                            </form>
                                        </td>
                                        <td style="width:30px;">
                                            <form action="" method="post">{% csrf_token %}
                                                <input type="hidden" name="name" value="{{ name }}">
                                                <button type="submit" class="btn btn-sm btn-danger" name="delete" value="delete" onclick="return confirm('{% trans "Are you sure?" %}')">{% trans "Delete" %}</button>
                                            </form>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p>{% trans "You do not have any snapshots for" %}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="graph">
                {% ifequal status 1 %}
                    <div id="cpu-usage">
                        <p style="margin-left: 25px">{% trans "CPU usage" %}</p>
                        <canvas style="margin-left: 25px" id="cpuChart" width="700" height="125"></canvas>
                    </div>
                    <div id="net-usage">
                        {% for network in networks %}
                            <p style="margin-left: 25px">{% trans "Bandwidth" %} - Eth{{ forloop.counter0 }}</p>
                            <canvas style="margin-left: 25px" id="netEth{{ forloop.counter0 }}Chart" width="700" height="125"></canvas>
                            <div id="lineLegend">
                                <span class="netIN">{% trans "In" %}</span>
                                <span class="netOUT">{% trans "Out" %}</span>
                            </div>
                        {% endfor %}
                    </div>
                    <div id="disk-usage">
                        {% for disk in disks %}
                           <p style="margin-left: 25px">{% trans "Disk I/O" %} - {{ disk.dev }}</p>
                           <canvas style="margin-left: 25px" id="blk{{ disk.dev }}Chart" width="700" height="125"></canvas>
                           <div id="lineLegend">
                                <span class="diskRD">{% trans "Read" %}</span>
                                <span class="diskWR">{% trans "Write" %}</span>
                           </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="well">
                        <h4>{% trans "Turn on your instance" %}</h4>
                    </div>
                {% endifequal %}
            </div>
            <div class="tab-pane" id="migrate">
                <ul class="nav nav-tabs" style="margin-top: 20px">
                    <li class="active"><a href="#instancemigate" data-toggle="tab">{% trans "Instance Migrate" %}</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane tab-inst active" id="instancemigate">
                        <p style="text-align:center;">
                            <span class="text-danger">{% trans "Warning:" %}</span> {% trans "Both servers must have equal settings and OS type" %}
                        </p>
                        <br>
                        <div class="row show-grid">
                            <div class="col-sm-3" style="text-align: right;padding-right: 2px;">
                                 <p><strong>{% trans "Original host" %}</strong></p>
                            </div>
                            <div class="col-sm-6">
                                 <p style="margin: 10px -10px 0 0;">{{ compute.name }}</p>
                            </div>
                        </div>
                        <form class="form-horizontal" method="post" role="form">{% csrf_token %}
                            <div class="form-group">
                                <label class="col-sm-3 control-label">{% trans "New host" %}</label>
                                <div class="col-sm-6">
                                    <select name="compute_id" class="form-control">
                                    {% if computes_count != 1 %}
                                        {% for comp in computes %}
                                            {% if comp.id != compute.id %}
                                                <option value="{{ comp.id }}">{{ comp.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                    </select>
                                </div>
                            </div>
                            {% ifequal status 5 %}
                                <button class="btn btn-lg btn-primary pull-right disabled">{% trans "Migrate" %}</button>
                            {% else %}
                                <button type="submit" class="btn btn-lg btn-primary pull-right" name="migrate">{% trans "Migrate" %}</button>
                            {% endifequal %}
                        </form>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="delete">

            </div>
        </div>
    </div>

    <!-- Delete -->
    <div class="modal fade" id="Delete" tabindex="-1" role="dialog" aria-labelledby="DeleteLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">{% trans "Undefined Server" %}</h4>
                </div>
                <div class="modal-body">
                    <p>{% trans "Delete HDD image?" %}</p>
                </div>
                <form class="form-group" method="post" role="form">{% csrf_token %}
                    <div class="checkbox">
                        <label>
                          <input type="checkbox" name="delete_disk" value="true"><strong>{% trans "Warning: if you check this box, VM's data will be lost!" %}</strong>
                        </label>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Close" %}</button>
                        <button type="submit" class="btn btn-primary" name="delete">{% trans "Delete" %}</button>
                    </div>
                </form>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- Migrate -->
    <div class="modal fade" id="Migrate" tabindex="-1" role="dialog" aria-labelledby="MigrateLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">{% trans "Migrate" %} '{{ vname }}'</h4>
                </div>
                <div class="modal-body">
                    <p style="text-align:center;">
                        <span class="text-danger">{% trans "Warning:" %}</span> {% trans "Both servers must have equal settings and OS type" %}
                    </p>
                    <br>
                    <div class="row show-grid">
                        <div class="col-lg-4" style="text-align:right;">
                             <p><strong>{% trans "Original host" %}</strong></p>
                        </div>
                        <div class="col-lg-4">
                             <p>{{ compute.name }}</p>
                        </div>
                    </div>
                </div>
                <form class="form-horizontal" method="post" role="form">{% csrf_token %}
                    <div class="form-group">
                        <label class="col-lg-4 control-label">{% trans "New host" %}</label>
                        <div class="col-lg-5">
                            <select name="compute_id" class="form-control">
                            {% if computes_count != 1 %}
                                {% for comp in computes %}
                                    {% if comp.id != compute.id %}
                                        <option value="{{ comp.id }}">{{ comp.name }}</option>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Close" %}</button>
                        <button type="submit" class="btn btn-primary" name="migrate">{% trans "Migrate" %}</button>
                    </div>
                </form>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- Modal Edit -->
    <div class="modal fade" id="Edit" tabindex="-1" role="dialog" aria-labelledby="addHostLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">{% trans "Change Virtual Machine Settings" %}</h4>
                </div>
                <div class="tabbable">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a href="#1" data-toggle="tab">{% trans "Settings" %}</a>
                        </li>
                        <li><a href="#2" data-toggle="tab">{% trans "VNC" %}</a></li>
                        <li><a href="#3" data-toggle="tab">{% trans "XML" %}</a></li>
                    </ul>
                </div>
                <div class="tab-content">
                    <div class="tab-pane active" id="1">
                        <form class="form-horizontal" method="post" role="form">{% csrf_token %}
                            <div class="modal-body">
                                <p style="font-weight:bold;">{% trans "Logical host CPUs:" %} {{ vcpu_host }}</p>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-4 control-label" style="font-weight:normal;"> {% trans "Current allocation" %}</label>
                                <div class="col-lg-6">
                                    <select name="cur_vcpu" class="form-control">
                                        {% for cpu in vcpu_range %}
                                            {% if cur_vcpu %}
                                                <option value="{{ cpu }}" {% if cpu == cur_vcpu %}selected{% endif %}>{{ cpu }}</option>
                                            {% else %}
                                                <option value="{{ cpu }}" {% if cpu == vcpu %}selected{% endif %}>{{ cpu }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-4 control-label" style="font-weight:normal;">{% trans "Maximum allocation" %}</label>
                                <div class="col-lg-6">
                                    <select name="vcpu" class="form-control">
                                        {% for cpu in vcpu_range %}
                                            <option value="{{ cpu }}" {% if cpu == vcpu %}selected{% endif %}>{{ cpu }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="modal-body">
                                <p style="font-weight:bold;">{% trans "Total host memory:" %} {{ memory_host|filesizeformat }}</p>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-4 control-label" style="font-weight:normal;">{% trans "Current allocation" %}</label>
                                <div class="col-lg-6">
                                    <select name="cur_memory" class="form-control">
                                        {% for mem in memory_range %}
                                            <option value="{{ mem }}" {% if mem == cur_memory %}selected{% endif %}>{{ mem }} {% trans "MB" %}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-4 control-label" style="font-weight:normal;">{% trans "Maximum allocation" %}</label>
                                <div class="col-lg-6">
                                    <select name="memory" class="form-control">
                                        {% for mem in memory_range %}
                                            <option value="{{ mem }}" {% if mem == memory %}selected{% endif %}>{{ mem }} {% trans "MB" %}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="modal-body">
                                <p style="font-weight:bold;">{% trans "Information" %}</p>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-4 control-label" style="font-weight:normal;">{% trans "Description" %}</label>
                                <div class="col-lg-6">
                                    <input type="text" class="form-control" name="description" value="{{ description }}"/>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Close" %}</button>
                                <button type="submit" class="btn btn-primary" name="change_settings">{% trans "Change" %}</button>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane" id="2">
                        <form class="form-horizontal" method="post" role="form">{% csrf_token %}
                            <div class="form-group">
                                <label for="inputPassword1" class="col-lg-3 control-label">{% trans "Generate" %}</label>
                                <div class="col-lg-6">
                                    <input type="checkbox" name="auto_pass" value="true" id="vnc_passwd_gen">
                                </div>
                            </div>
                            <div class="form-group" id="vnc_passwd_manual">
                                <label for="inputPassword1" class="col-lg-3 control-label">{% trans "Password" %}</label>
                                <div class="col-lg-6">
                                    <input type="password" class="form-control" name="vnc_passwd" placeholder="{% trans "Password" %}" maxlength="14">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Close" %}</button>
                                <button type="submit" class="btn btn-primary" name="set_vnc_passwd">{% trans "Change" %}</button>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane" id="3">
                        <div id="viewXMLpre">
                            <pre class="pre-scrollable">{{ inst_xml }}</pre>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Close" %}</button>
                                <button type="button" class="btn btn-primary" onclick="javascript:$('#viewXMLpre').hide();$('#viewXMLform').show();">{% trans "Edit" %}</button>
                            </div>
                        </div>
                        <form id="viewXMLform" class="form-horizontal" method="post" role="form" style="display: none;">{% csrf_token %}
                            <textarea class="form-control" rows="18" name="inst_xml">{{ inst_xml }}</textarea>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Close" %}</button>
                                <button type="submit" class="btn btn-danger" name="change_xml">{% trans "Save" %}</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
{% endblock %}
{% block script %}
    <script type="text/javascript">
        function open_vnc() { window.open('{% url 'console' %}?token={{ uuid }}','','width=850,height=485') }
    </script>
    <script src="{% static "js/Chart.min.js" %}"></script>
    <script type="text/javascript">
        $(document).on('change','#vnc_passwd_gen',function(){
            if($(this).prop('checked')) {
                $('#vnc_passwd_manual').hide();
            } else {
                $('#vnc_passwd_manual').show();
            }
        });
    </script>
    {% ifequal status 1 %}
        <script type="text/javascript">
            var cpu_ctx = $("#cpuChart").get(0).getContext("2d");
            var cpuChart = new Chart(cpu_ctx);
            function cpu_usage(){
                $.getJSON('/info/inst/cpu/{{ host_id }}/{{ vname }}', function(data) {
                    var options = {
                        animation : false,
                        pointDotRadius : 2,
                        scaleLabel : "<%=value%> %"
                    }
                    cpuChart.Line(data, options);
                });
            }

            var diskChart = {};
            {% for disk in disks %}
                var disk_ctx_{{ disk.dev }} = $("#blk{{ disk.dev }}Chart").get(0).getContext("2d");
                diskChart['{{ disk.dev }}'] = new Chart(disk_ctx_{{ disk.dev }});
            {% endfor %}
            function disk_usage(){
                $.getJSON('/info/inst/disk/{{ host_id }}/{{ vname }}', function(data) {
                    var options = {
                        animation : false,
                        pointDotRadius : 2,
                        scaleLabel : "<%=value%> Mb/s"
                    }
                    for(var i = 0; i < data.length; i++){
                        diskChart[data[i].dev].Line(data[i].data, options);
                    }
                });

            }

            var netChart = {};
            {% for net in networks %}
                var net_ctx_{{ forloop.counter0 }} = $("#netEth{{ forloop.counter0 }}Chart").get(0).getContext("2d");
                netChart['{{ forloop.counter0 }}'] = new Chart(net_ctx_{{ forloop.counter0 }});
            {% endfor %}
            function net_usage(){
                $.getJSON('/info/inst/net/{{ host_id }}/{{ vname }}', function(data) {
                    var options = {
                        animation : false,
                        pointDotRadius : 2,
                        scaleLabel : "<%=value%> Mbps"
                    }
                    for(var i = 0; i < data.length; i++){
                        netChart[[i]].Line(data[i].data, options);;
                    }
                });
            }
            $(function() {
                window.setInterval('cpu_usage()', {{ time_refresh }});
                window.setInterval('disk_usage()', {{ time_refresh }});
                window.setInterval('net_usage()', {{ time_refresh }});
            });
        </script>
    {% endifequal %}
{% endblock %}